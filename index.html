<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Garden Walkthrough</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body style="margin:0; overflow:hidden;">

<a-scene
  embedded
  xr-mode-ui="enabled: true"
  webxr="optionalFeatures: hit-test; referenceSpaceType: local-floor"
>
  <!-- Camera -->
  <a-entity camera look-controls position="0 1.6 0"></a-entity>

  <!-- Models start invisible -->
  <a-entity id="tree" gltf-model="tree.gltf" scale="0.5 0.5 0.5" visible="false"></a-entity>
  <a-entity id="jungleGym" gltf-model="jungleGym.glb" scale="0.02 0.02 0.02" visible="false"></a-entity>
  <a-entity id="flowers" gltf-model="flowers.glb" scale="0.05 0.05 0.05" visible="false"></a-entity>

  <a-entity light="type: ambient; intensity: 1"></a-entity>
  <a-entity light="type: directional; intensity: 0.6" position="0 1 1"></a-entity>
</a-scene>

<script>
  const tree = document.querySelector('#tree');
  const jungleGym = document.querySelector('#jungleGym');
  const flowers = document.querySelector('#flowers');
  const scene = document.querySelector('a-scene');

  let hitTestSource = null;
  let xrRefSpace = null;

  scene.addEventListener('enter-vr', async () => {
    if (navigator.xr) {
      const session = await navigator.xr.requestSession('immersive-ar', { optionalFeatures: ['hit-test'] });
      scene.renderer.xr.setSession(session);

      xrRefSpace = await session.requestReferenceSpace('local-floor');
      const viewerSpace = await session.requestReferenceSpace('viewer');
      hitTestSource = await session.requestHitTestSource({ space: viewerSpace });

      session.addEventListener('select', (event) => {
        const frame = event.frame;
        const hitResults = frame.getHitTestResults(hitTestSource);

        if (hitResults.length > 0) {
          const hitPose = hitResults[0].getPose(xrRefSpace);

          // Place tree first
          if (!tree.getAttribute('visible')) {
            tree.setAttribute('position', `${hitPose.transform.position.x} ${hitPose.transform.position.y} ${hitPose.transform.position.z}`);
            tree.setAttribute('visible', true);
            return;
          }

          // Place jungle gym second
          if (!jungleGym.getAttribute('visible')) {
            jungleGym.setAttribute('position', `${hitPose.transform.position.x + 1} ${hitPose.transform.position.y} ${hitPose.transform.position.z + 1}`);
            jungleGym.setAttribute('visible', true);
            return;
          }

          // Place flowers third
          if (!flowers.getAttribute('visible')) {
            flowers.setAttribute('position', `${hitPose.transform.position.x - 1} ${hitPose.transform.position.y} ${hitPose.transform.position.z + 1}`);
            flowers.setAttribute('visible', true);
            return;
          }
        }
      });
    } else {
      alert('WebXR not supported on this device/browser.');
    }
  });
</script>

</body>
</html>
